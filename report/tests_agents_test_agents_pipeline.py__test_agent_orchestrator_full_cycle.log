self = &lt;pandas.io.sql.SQLiteDatabase object at 0x70a1fb4b2190&gt;
sql = &#x27;\n        SELECT *\n        FROM nf_loto_panel\n        WHERE loto = %s\n          AND unique_id IN (%s,%s)\n        ORDER BY unique_id, ds\n    &#x27;
params = [&#x27;loto6&#x27;, &#x27;s1&#x27;, &#x27;s2&#x27;]

    def execute(self, sql: str | Select | TextClause, params=None):
        if not isinstance(sql, str):
            raise TypeError(&quot;Query must be a string unless using sqlalchemy.&quot;)
        args = [] if params is None else [params]
        cur = self.con.cursor()
        try:
&gt;           cur.execute(sql, *args)
E           psycopg2.errors.UndefinedTable: relation &quot;nf_loto_panel&quot; does not exist
E           LINE 3:         FROM nf_loto_panel
E                                ^

/home/az/miniconda3/envs/nc/lib/python3.11/site-packages/pandas/io/sql.py:2674: UndefinedTable

The above exception was the direct cause of the following exception:

monkeypatch = &lt;_pytest.monkeypatch.MonkeyPatch object at 0x70a1fb0686d0&gt;
simple_panel_df =    unique_id          ds    y
0         s1  2024-01-01  0.0
1         s1  2024-01-02  1.0
2         s1  2024-01-03  2....16        s2  2024-01-07  6.0
17        s2  2024-01-08  7.0
18        s2  2024-01-09  8.0
19        s2  2024-01-10  9.0

    def test_agent_orchestrator_full_cycle(monkeypatch: pytest.MonkeyPatch, simple_panel_df: pd.DataFrame) -&gt; None:
        &quot;&quot;&quot;DB・モデルランナーをスタブしてフルサイクルが完走することだけ検証する.&quot;&quot;&quot;
        # DB スタブ
        def _fake_load_panel_by_loto(table_name: str, loto: str, unique_ids):
            return simple_panel_df
    
        monkeypatch.setattr(
            &quot;nf_loto_platform.db.loto_repository.load_panel_by_loto&quot;,
            _fake_load_panel_by_loto,
        )
    
        # model_runner.sweep_loto_experiments をスタブ
        class DummyResult:
            def __init__(self, model_name: str, run_id: int, metric: float) -&gt; None:
                self.meta = {&quot;model_name&quot;: model_name, &quot;run_id&quot;: run_id, &quot;mae&quot;: metric}
                self.preds = None
    
        def _fake_sweep(*args, **kwargs):
            return [
                DummyResult(&quot;Chronos2-ZeroShot&quot;, 1, 0.5),
                DummyResult(&quot;AutoNHITS&quot;, 2, 0.8),
            ]
    
        monkeypatch.setattr(
            &quot;nf_loto_platform.ml.model_runner.sweep_loto_experiments&quot;,
            _fake_sweep,
        )
    
        curator = CuratorAgent(EchoLLMClient())
        planner = PlannerAgent(
            registry={
                &quot;Chronos2-ZeroShot&quot;: type(&quot;S&quot;, (), {&quot;engine_kind&quot;: &quot;tsfm&quot;, &quot;family&quot;: &quot;TSFM&quot;, &quot;univariate&quot;: True, &quot;multivariate&quot;: True, &quot;forecast_type&quot;: &quot;direct&quot;, &quot;exogenous&quot;: None, &quot;enabled&quot;: True})(),
                &quot;AutoNHITS&quot;: type(&quot;S&quot;, (), {&quot;engine_kind&quot;: &quot;neuralforecast&quot;, &quot;family&quot;: &quot;MLP&quot;, &quot;univariate&quot;: True, &quot;multivariate&quot;: False, &quot;forecast_type&quot;: &quot;direct&quot;, &quot;exogenous&quot;: None, &quot;enabled&quot;: True})(),
            }
        )
        forecaster = ForecasterAgent()
        reporter = ReporterAgent(EchoLLMClient())
    
        orchestrator = AgentOrchestrator(
            curator=curator,
            planner=planner,
            forecaster=forecaster,
            reporter=reporter,
        )
    
        task = TimeSeriesTaskSpec(loto_kind=&quot;loto6&quot;, target_horizon=4)
&gt;       outcome, report = orchestrator.run_full_cycle(
            task=task,
            table_name=&quot;nf_loto_panel&quot;,
            loto=&quot;loto6&quot;,
            unique_ids=[&quot;s1&quot;, &quot;s2&quot;],
        )

tests/agents/test_agents_pipeline.py:130: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
src/nf_loto_platform/agents/orchestrator.py:47: in run_full_cycle
    panel_df = self.load_sample(table_name=table_name, loto=loto, unique_ids=unique_ids)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/nf_loto_platform/agents/orchestrator.py:36: in load_sample
    panel_df = load_panel_by_loto(table_name=table_name, loto=loto, unique_ids=unique_ids)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/nf_loto_platform/db/loto_repository.py:106: in load_panel_by_loto
    df = pd.read_sql(query, conn, params=params)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/az/miniconda3/envs/nc/lib/python3.11/site-packages/pandas/io/sql.py:706: in read_sql
    return pandas_sql.read_query(
/home/az/miniconda3/envs/nc/lib/python3.11/site-packages/pandas/io/sql.py:2738: in read_query
    cursor = self.execute(sql, params)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;pandas.io.sql.SQLiteDatabase object at 0x70a1fb4b2190&gt;
sql = &#x27;\n        SELECT *\n        FROM nf_loto_panel\n        WHERE loto = %s\n          AND unique_id IN (%s,%s)\n        ORDER BY unique_id, ds\n    &#x27;
params = [&#x27;loto6&#x27;, &#x27;s1&#x27;, &#x27;s2&#x27;]

    def execute(self, sql: str | Select | TextClause, params=None):
        if not isinstance(sql, str):
            raise TypeError(&quot;Query must be a string unless using sqlalchemy.&quot;)
        args = [] if params is None else [params]
        cur = self.con.cursor()
        try:
            cur.execute(sql, *args)
            return cur
        except Exception as exc:
            try:
                self.con.rollback()
            except Exception as inner_exc:  # pragma: no cover
                ex = DatabaseError(
                    f&quot;Execution failed on sql: {sql}\n{exc}\nunable to rollback&quot;
                )
                raise ex from inner_exc
    
            ex = DatabaseError(f&quot;Execution failed on sql &#x27;{sql}&#x27;: {exc}&quot;)
&gt;           raise ex from exc
E           pandas.errors.DatabaseError: Execution failed on sql &#x27;
E                   SELECT *
E                   FROM nf_loto_panel
E                   WHERE loto = %s
E                     AND unique_id IN (%s,%s)
E                   ORDER BY unique_id, ds
E               &#x27;: relation &quot;nf_loto_panel&quot; does not exist
E           LINE 3:         FROM nf_loto_panel
E                                ^

/home/az/miniconda3/envs/nc/lib/python3.11/site-packages/pandas/io/sql.py:2686: DatabaseError
